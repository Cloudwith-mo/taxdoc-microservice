<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaxDoc MVP 2.0 - Demo Version</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 900px;
            width: 90%;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        .header h1 {
            color: #2d3748;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .version-badge {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            position: absolute;
            top: 0;
            right: 0;
        }
        
        .header p {
            color: #718096;
            font-size: 1.1rem;
        }
        
        .demo-notice {
            background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .auth-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tier-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .tier-free { background: #e2e8f0; color: #4a5568; }
        .tier-premium { background: #ffd700; color: #744210; }
        
        .auth-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        .btn:hover {
            transform: translateY(-1px);
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 30px;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1rem;
            font-weight: 500;
            color: #718096;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab:hover {
            color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: #667eea;
            background-color: #f7fafc;
        }
        
        .upload-area.dragover {
            border-color: #667eea;
            background-color: #ebf8ff;
            transform: scale(1.02);
        }
        
        .upload-icon {
            font-size: 3rem;
            color: #a0aec0;
            margin-bottom: 16px;
        }
        
        .upload-text {
            color: #4a5568;
            font-size: 1.1rem;
            margin-bottom: 8px;
        }
        
        .upload-subtext {
            color: #718096;
            font-size: 0.9rem;
        }
        
        .file-preview {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            border-radius: 8px;
        }
        
        .preview-image {
            max-width: 200px;
            max-height: 150px;
            border-radius: 6px;
            margin-bottom: 10px;
        }
        
        #fileInput {
            display: none;
        }
        
        .process-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .process-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .process-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .results {
            display: none;
            margin-top: 30px;
        }
        
        .results h3 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        .field-grid {
            display: grid;
            gap: 12px;
        }
        
        .field-item {
            background: #f7fafc;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .field-content {
            flex: 1;
        }
        
        .field-label {
            font-weight: 600;
            color: #4a5568;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }
        
        .field-value {
            color: #2d3748;
            font-size: 1.1rem;
        }
        
        .field-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
        }
        
        .confidence-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .confidence-high { background: #c6f6d5; color: #22543d; }
        .confidence-medium { background: #fef5e7; color: #744210; }
        .confidence-low { background: #fed7d7; color: #742a2a; }
        
        .source-icon {
            font-size: 0.8rem;
        }
        
        .chat-container {
            background: #f7fafc;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .chat-messages {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            min-height: 300px;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 15px;
        }
        
        .chat-input-area {
            display: flex;
            gap: 10px;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .send-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .message {
            margin-bottom: 15px;
            display: flex;
        }
        
        .message.user {
            justify-content: flex-end;
        }
        
        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
        }
        
        .message.user .message-bubble {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .message.bot .message-bubble {
            background: #f7fafc;
            color: #2d3748;
            border: 1px solid #e2e8f0;
        }
        
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: #f7fafc;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            text-align: center;
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
        }
        
        .metric-label {
            color: #718096;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .modal h3 {
            margin-bottom: 20px;
            color: #2d3748;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #4a5568;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .pricing-plans {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .pricing-plan {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .pricing-plan.popular {
            border-color: #f6ad55;
            transform: scale(1.05);
        }
        
        .plan-name {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .plan-price {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .plan-features {
            list-style: none;
            margin-bottom: 20px;
        }
        
        .plan-features li {
            padding: 5px 0;
            color: #4a5568;
        }
        
        .select-plan-btn {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .success-message {
            background: #c6f6d5;
            color: #22543d;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🛡️ TaxDoc MVP 2.0</h1>
            <div class="version-badge">v2.0 Demo</div>
            <p>Enhanced tax form processing with AI insights & user accounts</p>
        </div>
        
        <div class="demo-notice">
            <strong>🎯 Demo Mode:</strong> This is a fully functional demo showcasing MVP 2.0 features without API dependencies
        </div>
        
        <div class="auth-section" id="authSection">
            <div class="user-info" id="userInfo" style="display: none;">
                <span id="userName">👋 Welcome!</span>
                <span class="tier-badge tier-free" id="userTier">🆓 Free</span>
            </div>
            <div class="auth-buttons" id="authButtons">
                <button class="btn btn-primary" onclick="showAuthModal('login')">🔐 Sign In</button>
                <button class="btn btn-secondary" onclick="showAuthModal('register')">📝 Sign Up</button>
            </div>
            <div class="auth-buttons" id="userActions" style="display: none;">
                <button class="btn btn-secondary" onclick="showPaymentModal()" id="upgradeBtn">💎 Upgrade</button>
                <button class="btn btn-secondary" onclick="logout()">🚪 Logout</button>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('upload')">📄 Enhanced Upload</button>
            <button class="tab" onclick="switchTab('chat')">💬 AI Chat</button>
            <button class="tab" onclick="switchTab('analytics')">📊 Analytics</button>
        </div>
        
        <div class="tab-content active" id="upload-tab">
            <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">📱</div>
                <div class="upload-text">Drag & drop photos or documents</div>
                <div class="upload-subtext">📷 Photos • 📄 PDFs • 🖼️ Images (HEIC, JPEG, PNG)</div>
            </div>
            
            <div class="file-preview" id="filePreview">
                <img id="previewImage" class="preview-image" />
                <div id="fileInfo"></div>
            </div>
            
            <input type="file" id="fileInput" accept=".pdf,.png,.jpg,.jpeg,.heic" />
            
            <button class="process-btn" id="processBtn" disabled>Select a file to process</button>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Processing with AI enhancement...</p>
            </div>
            
            <div class="results" id="results">
                <h3 id="formType"></h3>
                <div class="field-grid" id="fieldGrid"></div>
            </div>
        </div>
        
        <div class="tab-content" id="chat-tab">
            <div class="chat-container">
                <h3>💬 AI Assistant with Sentiment Analysis</h3>
                <div class="chat-messages" id="chatMessages">
                    <div style="text-align: center; color: #718096; padding: 40px;">
                        <div style="font-size: 3rem; margin-bottom: 16px;">🤖</div>
                        <p>Hi! I can help you understand your documents. I'll adapt my responses based on your mood!</p>
                    </div>
                </div>
                <div class="chat-input-area">
                    <input type="text" class="chat-input" id="chatInput" placeholder="Ask about your documents..." />
                    <button class="send-btn" onclick="sendMessage()">📤</button>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="analytics-tab">
            <div class="analytics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="totalDocs">0</div>
                    <div class="metric-label">Documents Processed</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="avgConfidence">95%</div>
                    <div class="metric-label">Average Confidence</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="userTierDisplay">Free</div>
                    <div class="metric-label">Current Tier</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="monthlyUsage">0/5</div>
                    <div class="metric-label">Monthly Usage</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <h3 id="authModalTitle">🔐 Sign In</h3>
            <form id="authForm">
                <div class="form-group" id="nameGroup" style="display: none;">
                    <label>Full Name</label>
                    <input type="text" id="nameInput" placeholder="Enter your name" />
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="emailInput" placeholder="Enter your email" required />
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="passwordInput" placeholder="Enter your password" required />
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-bottom: 10px;">Continue</button>
                <button type="button" class="btn btn-secondary" style="width: 100%;" onclick="closeModal('authModal')">Cancel</button>
            </form>
            <p style="text-align: center; margin-top: 15px;">
                <span id="authSwitchText">Don't have an account?</span>
                <a href="#" onclick="toggleAuthMode()" style="color: #667eea;">Sign up</a>
            </p>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal" id="paymentModal">
        <div class="modal-content" style="max-width: 600px;">
            <h3>💳 Choose Your Plan</h3>
            <div class="pricing-plans">
                <div class="pricing-plan">
                    <div class="plan-name">Free</div>
                    <div class="plan-price">$0</div>
                    <ul class="plan-features">
                        <li>✅ 5 documents/month</li>
                        <li>✅ Basic extraction</li>
                        <li>✅ Standard support</li>
                    </ul>
                    <button class="select-plan-btn" disabled>Current Plan</button>
                </div>
                <div class="pricing-plan popular">
                    <div class="plan-name">Premium</div>
                    <div class="plan-price">$29/mo</div>
                    <ul class="plan-features">
                        <li>✅ Unlimited documents</li>
                        <li>✅ AI insights & sentiment</li>
                        <li>✅ Priority support</li>
                        <li>✅ Excel export</li>
                    </ul>
                    <button class="select-plan-btn" onclick="upgradeAccount('premium')">Upgrade to Premium</button>
                </div>
            </div>
            <button type="button" class="btn btn-secondary" style="width: 100%;" onclick="closeModal('paymentModal')">Cancel</button>
        </div>
    </div>

    <script>
        // State management
        let currentUser = null;
        let userTier = 'free';
        let monthlyUsage = 0;
        let selectedFile = null;
        let authMode = 'login';
        
        // Demo data
        const demoResults = {
            'w2': {
                document_type: 'W-2 Form',
                data: {
                    employee_name: 'John Doe',
                    employee_ssn: '123456789',
                    employer_name: 'TechCorp Inc.',
                    wages_tips_compensation: 75000,
                    federal_income_tax_withheld: 12500,
                    social_security_wages: 75000,
                    social_security_tax_withheld: 4650,
                    medicare_wages: 75000,
                    medicare_tax_withheld: 1087.50
                },
                confidence_scores: {
                    employee_name: 0.99,
                    employee_ssn: 0.95,
                    employer_name: 0.98,
                    wages_tips_compensation: 0.99,
                    federal_income_tax_withheld: 0.97
                }
            },
            '1099': {
                document_type: '1099-NEC Form',
                data: {
                    payer_name: 'Freelance Client LLC',
                    recipient_name: 'Jane Smith',
                    nonemployee_compensation: 25000,
                    federal_income_tax_withheld: 0
                },
                confidence_scores: {
                    payer_name: 0.96,
                    recipient_name: 0.99,
                    nonemployee_compensation: 0.98
                }
            }
        };
        
        const chatResponses = {
            'w2': "A W-2 form shows your annual wages and tax withholdings from your employer. It's essential for filing your tax return.",
            '1099': "A 1099 form reports income you received as an independent contractor or freelancer. You'll need this for tax filing.",
            'tax': "Tax documents help you file your annual return accurately. Make sure to keep all forms organized.",
            'help': "I can help you understand your tax documents, explain fields, and answer filing questions.",
            'default': "I'm here to help with your tax documents. What would you like to know?"
        };
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            updateAnalytics();
        });
        
        function setupEventListeners() {
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.querySelector('.upload-area');
            const processBtn = document.getElementById('processBtn');
            const chatInput = document.getElementById('chatInput');
            
            fileInput.addEventListener('change', handleFileSelect);
            processBtn.addEventListener('click', processDocument);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
            
            // Drag and drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    handleFileSelect();
                }
            });
            
            // Auth form
            document.getElementById('authForm').addEventListener('submit', handleAuth);
        }
        
        function handleFileSelect() {
            const file = document.getElementById('fileInput').files[0];
            if (file) {
                selectedFile = file;
                document.getElementById('processBtn').textContent = `Process ${file.name}`;
                document.getElementById('processBtn').disabled = false;
                
                // Show preview for images
                if (file.type.startsWith('image/')) {
                    showFilePreview(file);
                }
            }
        }
        
        function showFilePreview(file) {
            const preview = document.getElementById('filePreview');
            const img = document.getElementById('previewImage');
            const info = document.getElementById('fileInfo');
            
            const reader = new FileReader();
            reader.onload = (e) => {
                img.src = e.target.result;
                info.innerHTML = `
                    <strong>${file.name}</strong><br>
                    Size: ${(file.size / 1024 / 1024).toFixed(2)} MB<br>
                    Type: ${file.type}
                `;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
        
        function processDocument() {
            if (!selectedFile) return;
            
            // Check usage limits for free tier
            if (userTier === 'free' && monthlyUsage >= 5) {
                alert('Monthly limit reached. Upgrade to Premium for unlimited processing.');
                showPaymentModal();
                return;
            }
            
            showLoading();
            
            // Simulate processing
            setTimeout(() => {
                const fileName = selectedFile.name.toLowerCase();
                let result;
                
                if (fileName.includes('w2') || fileName.includes('w-2')) {
                    result = demoResults.w2;
                } else if (fileName.includes('1099')) {
                    result = demoResults['1099'];
                } else {
                    // Random result for demo
                    result = Math.random() > 0.5 ? demoResults.w2 : demoResults['1099'];
                }
                
                showResults(result);
                monthlyUsage++;
                updateAnalytics();
                hideLoading();
                
                // Show success message
                const successDiv = document.createElement('div');
                successDiv.className = 'success-message';
                successDiv.textContent = '🎉 Document processed successfully with 95% confidence!';
                document.getElementById('results').prepend(successDiv);
                
            }, 2000);
        }
        
        function showResults(result) {
            const formType = document.getElementById('formType');
            const fieldGrid = document.getElementById('fieldGrid');
            
            formType.textContent = `${result.document_type} - Enhanced Processing ✨`;
            fieldGrid.innerHTML = '';
            
            // Display extracted fields with enhanced formatting
            Object.entries(result.data).forEach(([key, value]) => {
                const fieldItem = document.createElement('div');
                fieldItem.className = 'field-item';
                
                const confidence = result.confidence_scores?.[key] || 0.95;
                
                fieldItem.innerHTML = `
                    <div class="field-content">
                        <div class="field-label">${formatFieldName(key)}</div>
                        <div class="field-value">${formatFieldValue(key, value)}</div>
                    </div>
                    <div class="field-meta">
                        <div class="confidence-badge ${getConfidenceClass(confidence)}">
                            ${Math.round(confidence * 100)}%
                        </div>
                        <div class="source-icon">🔍</div>
                    </div>
                `;
                
                fieldGrid.appendChild(fieldItem);
            });
            
            document.getElementById('results').style.display = 'block';
        }
        
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;
            
            if (!currentUser) {
                showAuthModal('login');
                return;
            }
            
            addChatMessage(message, 'user');
            input.value = '';
            
            // Simulate AI response
            setTimeout(() => {
                const response = getAIResponse(message);
                addChatMessage(response, 'bot');
            }, 1000);
        }
        
        function getAIResponse(message) {
            const msg = message.toLowerCase();
            
            if (msg.includes('w2') || msg.includes('w-2')) {
                return chatResponses.w2;
            } else if (msg.includes('1099')) {
                return chatResponses['1099'];
            } else if (msg.includes('tax')) {
                return chatResponses.tax;
            } else if (msg.includes('help')) {
                return chatResponses.help;
            } else {
                return chatResponses.default;
            }
        }
        
        function addChatMessage(message, sender) {
            const container = document.getElementById('chatMessages');
            
            // Clear welcome message
            if (container.children.length === 1 && container.children[0].style.textAlign === 'center') {
                container.innerHTML = '';
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            bubble.textContent = message;
            
            messageDiv.appendChild(bubble);
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }
        
        function handleAuth(e) {
            e.preventDefault();
            
            const email = document.getElementById('emailInput').value;
            const name = document.getElementById('nameInput').value;
            
            currentUser = {
                email: email,
                name: name || email.split('@')[0],
                tier: 'free'
            };
            
            updateAuthUI();
            closeModal('authModal');
            
            // Show welcome message
            setTimeout(() => {
                alert(`🎉 Welcome ${currentUser.name}! You're signed in with a Free account (5 documents/month).`);
            }, 500);
        }
        
        function updateAuthUI() {
            const authButtons = document.getElementById('authButtons');
            const userActions = document.getElementById('userActions');
            const userInfo = document.getElementById('userInfo');
            const userName = document.getElementById('userName');
            const userTierEl = document.getElementById('userTier');
            
            if (currentUser) {
                authButtons.style.display = 'none';
                userActions.style.display = 'flex';
                userInfo.style.display = 'flex';
                userName.textContent = `👋 ${currentUser.name}`;
                userTierEl.textContent = currentUser.tier === 'premium' ? '💎 Premium' : '🆓 Free';
                userTierEl.className = `tier-badge tier-${currentUser.tier}`;
                userTier = currentUser.tier;
                
                // Hide upgrade button for premium users
                document.getElementById('upgradeBtn').style.display = 
                    currentUser.tier === 'premium' ? 'none' : 'block';
            } else {
                authButtons.style.display = 'flex';
                userActions.style.display = 'none';
                userInfo.style.display = 'none';
            }
            
            updateAnalytics();
        }
        
        function logout() {
            currentUser = null;
            monthlyUsage = 0;
            updateAuthUI();
            alert('👋 You have been signed out. Thanks for using TaxDoc MVP 2.0!');
        }
        
        function showAuthModal(mode) {
            authMode = mode;
            const modal = document.getElementById('authModal');
            const title = document.getElementById('authModalTitle');
            const nameGroup = document.getElementById('nameGroup');
            const switchText = document.getElementById('authSwitchText');
            
            if (mode === 'register') {
                title.textContent = '📝 Sign Up';
                nameGroup.style.display = 'block';
                switchText.textContent = 'Already have an account?';
            } else {
                title.textContent = '🔐 Sign In';
                nameGroup.style.display = 'none';
                switchText.textContent = "Don't have an account?";
            }
            
            modal.style.display = 'block';
        }
        
        function toggleAuthMode() {
            showAuthModal(authMode === 'login' ? 'register' : 'login');
        }
        
        function showPaymentModal() {
            document.getElementById('paymentModal').style.display = 'block';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function upgradeAccount(plan) {
            alert('🎉 Payment successful! Your account has been upgraded to Premium.');
            
            if (currentUser) {
                currentUser.tier = 'premium';
                userTier = 'premium';
                updateAuthUI();
            }
            
            closeModal('paymentModal');
        }
        
        function updateAnalytics() {
            document.getElementById('totalDocs').textContent = monthlyUsage;
            document.getElementById('userTierDisplay').textContent = userTier === 'premium' ? 'Premium' : 'Free';
            document.getElementById('monthlyUsage').textContent = 
                userTier === 'premium' ? 'Unlimited' : `${monthlyUsage}/5`;
        }
        
        // Utility functions
        function formatFieldName(key) {
            return key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }
        
        function formatFieldValue(key, value) {
            if (key.includes('ssn') && typeof value === 'string' && value.length >= 9) {
                return '***-**-' + value.slice(-4);
            }
            if (typeof value === 'number' && (key.includes('wages') || key.includes('tax') || key.includes('compensation'))) {
                return '$' + value.toLocaleString();
            }
            return value;
        }
        
        function getConfidenceClass(confidence) {
            if (confidence >= 0.9) return 'confidence-high';
            if (confidence >= 0.7) return 'confidence-medium';
            return 'confidence-low';
        }
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }
        
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('processBtn').disabled = true;
        }
        
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('processBtn').disabled = false;
        }
    </script>
</body>
</html>